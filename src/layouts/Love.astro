---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Date Remoun" } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <meta name="robots" content="noindex" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap" rel="stylesheet">
  <title>{title}</title>
  <script is:inline>
    // Immediate theme initialization to prevent FOUC
    (function() {
      const savedMood = localStorage.getItem('remoun-mood') || 'rainbow';
      document.documentElement.setAttribute('data-mood', savedMood);
      document.documentElement.setAttribute('data-theme', savedMood === 'rainbow' ? 'light' : 'dark');
    })();
  </script>
</head>

<style is:global>
  :root {
    --love-border-radius: 24px;
  }

  /* 
     THEME INDEPENDENCE ENGINE
     We use high specificity and !important for core variables 
     to ensure the mood always wins against global dark mode.
  */
  
  /* Rainbow Mood (Light) */
  html[data-mood="rainbow"] {
    color-scheme: light !important;
    --mood-bg: #faf9f7 !important;
    --mood-text: #1a1a1a !important;
    --mood-accent: #3063c7 !important;
    --mood-card-bg: #ffffff !important;
    --mood-border: #e5e3df !important;
    --mood-accent-soft: #f0f4ff !important;
    --mood-shadow: 0 4px 20px rgba(48, 99, 199, 0.08) !important;
    --mood-font-display: 'Instrument Sans', sans-serif !important;
    
    /* Override global.css variables */
    --bg: #faf9f7 !important;
    --text: #1a1a1a !important;
    --border: #e5e3df !important;
    --surface: #f0eee9 !important;
    --accent: #3063c7 !important;
  }

  /* Wednesday Mood (Dark) */
  html[data-mood="wednesday"] {
    color-scheme: dark !important;
    --mood-bg: #0a0a0a !important;
    --mood-text: #e0e0e0 !important;
    --mood-accent: #ffffff !important;
    --mood-card-bg: #151515 !important;
    --mood-border: #333333 !important;
    --mood-accent-soft: #1a1a1a !important;
    --mood-shadow: 0 4px 20px rgba(0, 0, 0, 0.5) !important;
    --mood-font-display: 'Newsreader', serif !important;

    /* Override global.css variables */
    --bg: #0a0a0a !important;
    --text: #e0e0e0 !important;
    --border: #333333 !important;
    --surface: #151515 !important;
    --accent: #ffffff !important;
  }

  /* Shared styles using nesting */
  html[data-mood] {
    /* Force background and text colors */
    &, & body.love-body {
      background-color: var(--mood-bg) !important;
      background-image: none !important;
      color: var(--mood-text) !important;
      transition: background-color 0.5s ease, color 0.5s ease;
    }

    /* Wednesday-specific photo tweaks */
    &[data-mood="wednesday"] {
      .photo-card, .hero-polaroid {
        filter: grayscale(0.8) contrast(1.1);
        transition: filter 0.5s ease;
        &:hover { filter: grayscale(0) contrast(1); }
      }
      .rainbow-text { color: #a0aec0 !important; }
      .mood-slider { transform: translateX(48px); }
    }

    /* Shared element overrides */
    h1, h2, h3, h4, p, li, span, 
    div:not(.mood-toggle-container, .mood-toggle, .mood-slider, .mood-btn) {
      color: var(--mood-text) !important;
    }

    p:last-child {
      margin-bottom: 0;
    }

    b, strong, a { color: var(--mood-accent) !important; }

    /* Shared Card Styles */
    .content-block, .note-box, .read-me-item, .testimonial, 
    .photo-placeholder, .oscillation-centerpiece {
      background: var(--mood-card-bg) !important;
      color: var(--mood-text) !important;
      border: 1px solid var(--mood-border) !important;
      border-radius: var(--love-border-radius);
      box-shadow: var(--mood-shadow) !important;
      text-align: left;
      padding: 2rem;
      margin-bottom: 2rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.5s ease, border-color 0.5s ease;
    }

    .photo-card, .hero-polaroid {
      background: white !important;
      padding: 1rem !important;
      display: flex;
      flex-direction: column;
      border: 1px solid #e5e3df !important;
      margin-bottom: 2rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.5s ease, border-color 0.5s ease;
    }

    .note-box.casual-note, .manifesto, .greeting p {
      background: var(--mood-accent-soft) !important;
      color: var(--mood-text) !important;
    }

    .note-box.casual-note { 
      border: 2px solid var(--mood-accent) !important;
      padding: 2rem;
    }

    .manifesto {
      border-left: 4px solid var(--mood-accent) !important;
      padding: 1.5rem 2rem;
      margin: 2rem 0;
      border-radius: var(--love-border-radius) !important;
      h3 {
        margin-top: 0 !important;
        margin-bottom: 0.75rem !important;
        text-align: left;
        &::after { display: none !important; }
      }
    }

    .greeting {
      text-align: center;
      margin-bottom: 2rem;
    }

    .greeting p {
      border: 1px solid var(--mood-border) !important;
      padding: 0.8rem 1.5rem;
      border-radius: 100px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    /* Centerpiece Styles */
    .oscillation-centerpiece {
      margin: 4rem 0;
      padding: 2rem;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      .centerpiece-info {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        z-index: 5;
      }
    }

    .quote-line {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      line-height: 1.2;
      font-weight: 700;
      &.wednesday-text {
        font-family: 'Newsreader', serif;
        font-style: italic;
        align-self: flex-start;
        text-align: left;
      }
      &.rainbow-text {
        font-family: 'Instrument Sans', sans-serif;
        color: #3063c7 !important;
        align-self: flex-end;
        text-align: right;
      }
    }

    /* Mood Toggle */
    .mood-toggle-container {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.75rem;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s ease;

      &.highlight {
        transform: scale(1.3);
        filter: drop-shadow(0 0 15px var(--mood-accent));
        .mood-toggle {
          border-color: var(--mood-accent) !important;
          border-width: 2px !important;
        }
      }
    }

    .mood-info-link {
      width: 24px;
      height: 24px;
      background: var(--mood-card-bg);
      border: 1px solid var(--mood-border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      text-decoration: none;
      color: var(--mood-text) !important;
      opacity: 0.6;
      transition: all 0.2s ease;
      &:hover {
        opacity: 1;
        transform: scale(1.1);
        border-color: var(--mood-accent);
      }
    }

    .mood-toggle {
      background: var(--mood-card-bg) !important;
      border: 1px solid var(--mood-border) !important;
      padding: 0.5rem;
      border-radius: 100px;
      display: flex;
      gap: 0.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      cursor: pointer;
      position: relative;
    }

    .mood-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      border: none;
      background: transparent;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    .mood-slider {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      width: 40px;
      height: 40px;
      background: var(--mood-accent) !important;
      border-radius: 50%;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    /* Button color logic */
    &[data-mood="rainbow"] .mood-btn[data-set-mood="rainbow"],
    &[data-mood="wednesday"] .mood-btn[data-set-mood="wednesday"] {
      color: var(--mood-bg) !important;
    }
    &[data-mood="rainbow"] .mood-btn[data-set-mood="wednesday"],
    &[data-mood="wednesday"] .mood-btn[data-set-mood="rainbow"] {
      color: var(--mood-text) !important;
    }
  }

  /* Shared Layout & Utility Styles */
  html[data-mood] {
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem 1.5rem;
    }

    .love-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--mood-border) !important;
      .logo {
        font-family: var(--font-display);
        font-weight: 800;
        font-size: 1.5rem;
        color: var(--mood-accent) !important;
        text-decoration: none;
        letter-spacing: -0.04em;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      nav {
        display: flex;
        gap: 2rem;
        a {
          font-family: var(--font-display);
          font-size: 1rem;
          font-weight: 700;
          text-decoration: none;
          transition: all 0.2s ease;
          position: relative;
          color: var(--mood-text) !important;
          &::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--mood-accent) !important;
            transition: width 0.2s ease;
          }
          &:hover::after { width: 100% !important; }
        }
      }
    }

    .greeting {
      text-align: center;
      margin: 0.75rem 0 1.25rem;
    }

    .greeting p {
      border: 1px solid var(--mood-border) !important;
      padding: 0.6rem 1.5rem;
      border-radius: 100px;
      display: inline-block;
      font-weight: 500;
      font-size: 0.95rem;
      line-height: 1.5;
      max-width: fit-content;
    }

    .intro {
      text-align: left;
      padding: 0.5rem 0 1rem;
      position: relative;
      max-width: 900px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 2.5rem;
      align-items: center;
      h1 {
        font-size: clamp(2rem, 5vw, 3rem);
        line-height: 1.05;
        margin-bottom: 0.75rem;
        font-weight: 800;
        letter-spacing: -0.05em;
        text-wrap: balance;
      }
      .tagline-container {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        border-left: 3px solid var(--mood-accent) !important;
        padding-left: 1.25rem;
        margin-top: 0.75rem;
      }
      .tagline {
        font-family: var(--font-display);
        font-size: 1.15rem;
        font-weight: 500;
        margin: 0;
        opacity: 0.9;
        line-height: 1.25;
      }
      .intro-visual {
        max-width: 280px;
        width: 100%;
        margin: 0 auto;
        img {
          width: 100%;
          height: auto;
        }
      }
    }

    .note-box {
      margin: 1rem 0;
      padding: 1.25rem 1.5rem;
      p {
        margin: 0.5rem 0;
        &:first-child { margin-top: 0; }
        &:last-child { margin-bottom: 0; }
      }
    }

    li {
      background: var(--mood-card-bg) !important;
      border: 1px solid var(--mood-border) !important;
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
      margin: 0.5rem 0;
      display: block;
      list-style: none;
      width: 100%;
      position: relative;
      overflow: hidden;
      text-align: left;
      &::before {
        content: 'â†’' !important;
        display: inline-block !important;
        position: relative !important;
        top: 0 !important;
        left: 0 !important;
        width: auto !important;
        height: auto !important;
        background: none !important;
        color: var(--mood-accent) !important;
        margin-right: 0.75rem !important;
        font-family: var(--font-display) !important;
        font-weight: bold !important;
        flex-shrink: 0 !important;
      }
      &::after {
        display: none !important;
      }
    }

    .read-me-grid, .enjoy-grid ul {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 1.5rem 0;
      padding: 0;
      list-style: none;
    }

    .read-me-grid {
      gap: 1.5rem;
      margin: 2.5rem 0;
      .read-me-item strong {
        display: block;
        font-family: var(--font-display);
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        color: var(--mood-accent) !important;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
    }

    .testimonial {
      margin: 2rem 0;
      padding: 2rem;
      &::before {
        content: 'âœ¨' !important;
        position: absolute !important;
        top: 1rem !important;
        left: 1rem !important;
        font-size: 1.5rem !important;
        color: var(--mood-accent) !important;
        opacity: 0.2 !important;
        line-height: 1 !important;
        transition: transform 0.5s ease;
      }
      .testimonial-author {
        margin-top: 1.5rem !important;
        font-family: var(--font-display);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        &::before {
          content: '' !important;
          width: 20px !important;
          height: 2px !important;
          background: var(--mood-accent) !important;
          display: block !important;
        }
      }
    }

    .cta-section {
      padding: 3rem 2rem;
      border-radius: var(--love-border-radius);
      text-align: center;
      margin: 4rem 0;
      border: 2px dashed var(--mood-accent) !important;
    }

    .cta-button {
      display: inline-block;
      background: var(--mood-accent) !important;
      color: var(--mood-bg) !important;
      padding: 1.5rem 3rem;
      border-radius: 100px;
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 1.25rem;
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      &:hover {
        transform: translateY(-5px) scale(1.05) !important;
        box-shadow: 0 15px 30px rgba(0,0,0,0.2) !important;
      }
    }

    h2 {
      text-align: center;
      font-size: 2.5rem;
      margin-top: 5rem;
      margin-bottom: 2rem;
      position: relative;
      &::after {
        content: '' !important;
        display: block !important;
        width: 60px !important;
        height: 4px !important;
        background: var(--mood-accent) !important;
        margin: 0.5rem auto 0;
        border-radius: 2px !important;
      }
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
      gap: 2rem;
      margin: 3rem 0;
      align-items: stretch;
    }

    .photo-card, .hero-polaroid {
      background: white !important;
      padding: 1rem !important;
      display: flex;
      flex-direction: column;
      border: 1px solid #e5e3df !important;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05) !important;
      transform: rotate(-1deg);
      transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.5s ease, border-color 0.5s ease;
      &:hover {
        transform: rotate(0deg) scale(1.02);
        box-shadow: 0 8px 30px rgba(48, 99, 199, 0.12) !important;
      }
      &:nth-of-type(even) {
        transform: rotate(1.5deg);
        &:hover {
          transform: rotate(0deg) scale(1.02);
        }
      }
      img {
        width: 100%;
        border-radius: 2px;
        margin-bottom: 0.75rem;
        display: block;
        background: #f0f0f0;
        flex-shrink: 0;
        cursor: zoom-in;
      }
      &[data-caption]::after {
        content: attr(data-caption) !important;
        display: block !important;
        text-align: center;
        font-family: 'Newsreader', serif;
        font-style: italic;
        color: #555 !important;
        font-size: 0.9rem;
        margin-top: auto;
        padding-top: 0.5rem;
      }
    }

    .hero-polaroid {
      transform: rotate(3deg) !important;
      max-width: 320px;
      margin: 1rem auto;
      &:hover {
        transform: rotate(0deg) translateY(-10px) scale(1.05) !important;
      }
    }

    /* Vibe Notes Section */
    .vibe-notes {
      margin-top: 6rem;
      padding: 3rem;
      border-top: 1px solid var(--mood-border) !important;
      font-size: 0.95rem;
      color: var(--mood-text) !important;
      opacity: 0.8;
      h3 {
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }
      .vibe-note {
        margin-bottom: 1.5rem;
        strong { color: var(--mood-accent) !important; }
      }
    }
  }

  /* Lightbox Styles */
  #lightbox {
    display: none;
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 17, 23, 0.95);
    backdrop-filter: blur(10px);
    justify-content: center;
    align-items: center;
    cursor: zoom-out;
    opacity: 0;
    transition: opacity 0.3s ease;
    &.active {
      display: flex;
      opacity: 1;
      img { transform: scale(1); }
    }
    img {
      max-width: 90%;
      max-height: 85vh;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      border-radius: 4px;
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .lightbox-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 90%;
      gap: 1rem;
    }
    .lightbox-caption {
      color: white !important;
      font-family: 'Newsreader', serif;
      font-style: italic;
      font-size: 1.2rem;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      animation: fadeIn 0.3s ease forwards;
    }
    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white !important;
      font-size: 2rem;
      cursor: pointer;
      background: none;
      border: none;
      padding: 10px;
      line-height: 1;
    }
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: white !important;
      font-size: 3rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 20px;
      opacity: 0.5;
      transition: opacity 0.2s ease, transform 0.2s ease;
      &:hover {
        opacity: 1;
        transform: translateY(-50%) scale(1.1);
      }
      &.lightbox-prev { left: 10px; }
      &.lightbox-next { right: 10px; }
    }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Responsive Adjustments */
  @media (max-width: 850px) {
    html[data-mood] .intro {
      grid-template-columns: 1fr;
      text-align: center;
      padding: 0.5rem 0 1rem;
      gap: 2rem;
      .tagline-container {
        border-left: none !important;
        padding-left: 0 !important;
        align-items: center;
      }
    }
  }

  @media (max-width: 600px) {
    html[data-mood] {
      .read-me-grid, .enjoy-grid ul { grid-template-columns: 1fr; }
      .love-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }
  }
</style>

<body class="love-body">
  <div class="container">
    <header class="love-header">
      <a href="/" class="logo">Remoun</a>
      <nav>
        <a href="#who-i-am">Who</a>
        <a href="#life-design">Looking</a>
        <a href="#reach-out">Reach Out</a>
      </nav>
    </header>
    <main>
      <slot />
    </main>

    <div class="mood-toggle-container">
      <div class="mood-toggle" id="mood-toggle">
        <div class="mood-slider"></div>
        <button class="mood-btn" data-set-mood="rainbow" aria-label="Rainbow Mode">ðŸŒˆ</button>
        <button class="mood-btn" data-set-mood="wednesday" aria-label="Wednesday Mode">ðŸ–¤</button>
      </div>
      <a href="#vibe-check" class="mood-info-link" title="What is this?">?</a>
    </div>
  </div>

  <div id="lightbox">
    <button class="lightbox-close" aria-label="Close">&times;</button>
    <button class="lightbox-nav lightbox-prev" aria-label="Previous">&lsaquo;</button>
    <div class="lightbox-content">
      <img src="" alt="Lightbox image" />
      <div class="lightbox-caption"></div>
    </div>
    <button class="lightbox-nav lightbox-next" aria-label="Next">&rsaquo;</button>
  </div>

  <script is:inline>
    // Mood Toggle Logic
    const moodToggle = document.getElementById('mood-toggle');
    const moodBtns = moodToggle.querySelectorAll('.mood-btn');
    
    function setMood(mood) {
      document.documentElement.setAttribute('data-mood', mood);
      document.documentElement.setAttribute('data-theme', mood === 'rainbow' ? 'light' : 'dark');
      localStorage.setItem('remoun-mood', mood);
    }

    moodBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        setMood(btn.getAttribute('data-set-mood'));
      });
    });

    // Initialize mood
    (function() {
      const savedMood = localStorage.getItem('remoun-mood') || 'rainbow';
      setMood(savedMood);
    })();

    // Lightbox Logic
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = lightbox.querySelector('img');
    const lightboxCaption = lightbox.querySelector('.lightbox-caption');
    const photos = Array.from(document.querySelectorAll('.photo-card img, .hero-polaroid img'));
    let currentIndex = 0;

    function updateLightbox() {
      const currentPhoto = photos[currentIndex];
      if (!currentPhoto) return;
      lightboxImg.src = currentPhoto.src;
      const parentCard = currentPhoto.closest('.photo-card, .hero-polaroid');
      const captionText = parentCard?.getAttribute('data-caption') || currentPhoto.alt;
      
      if (captionText) {
        lightboxCaption.textContent = captionText;
        lightboxCaption.style.display = 'block';
      } else {
        lightboxCaption.style.display = 'none';
      }
    }

    function openLightbox(index) {
      currentIndex = index;
      updateLightbox();
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }

    function showNext() {
      currentIndex = (currentIndex + 1) % photos.length;
      updateLightbox();
    }

    function showPrev() {
      currentIndex = (currentIndex - 1 + photos.length) % photos.length;
      updateLightbox();
    }

    photos.forEach((img, index) => {
      img.addEventListener('click', (e) => {
        e.stopPropagation();
        openLightbox(index);
      });
    });

    lightbox.addEventListener('click', closeLightbox);
    lightbox.querySelector('.lightbox-prev').addEventListener('click', (e) => {
      e.stopPropagation();
      showPrev();
    });
    lightbox.querySelector('.lightbox-next').addEventListener('click', (e) => {
      e.stopPropagation();
      showNext();
    });

    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('active')) return;
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') showNext();
      if (e.key === 'ArrowLeft') showPrev();
    });

    // Intersection Observer for highlighting the mood toggle when the centerpiece is visible
    function initObserver() {
      const centerpiece = document.querySelector('.oscillation-centerpiece');
      const toggleContainer = document.querySelector('.mood-toggle-container');

      if (centerpiece && toggleContainer) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              toggleContainer.classList.add('highlight');
            } else {
              toggleContainer.classList.remove('highlight');
            }
          });
        }, {
          threshold: 0.3
        });

        observer.observe(centerpiece);
      }
    }

    // Run on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initObserver);
    } else {
      initObserver();
    }
  </script>
</body>
</html>
